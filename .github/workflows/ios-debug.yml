name: ğŸ Build iOS Debug

on:
  push:
    branches: [develop, feature/*]
  pull_request:
    branches: [develop, main]
  workflow_dispatch:

jobs:
  build-ios-debug:
    name: Build iOS Debug App
    runs-on: macos-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ğŸ’ Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1'
          bundler-cache: true
          working-directory: ios

      - name: ğŸ”„ Cache CocoaPods
        uses: actions/cache@v4
        with:
          path: ios/Pods
          key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
          restore-keys: |
            ${{ runner.os }}-pods-

      - name: ğŸ“¦ Install dependencies
        run: npm ci --legacy-peer-deps

      - name: â„¹ï¸ Show React Native info
        run: npx react-native info

      - name: ğŸ Install CocoaPods dependencies
        run: cd ios && pod install --repo-update

      - name: ğŸ“± List available simulators
        run: xcrun simctl list devices available

      - name: ğŸ—ï¸ Build iOS Debug App
        run: |
          cd ios
          xcodebuild -workspace seraApp.xcworkspace \
                     -scheme seraApp \
                     -configuration Debug \
                     -destination 'platform=iOS Simulator,name=iPhone 15,OS=latest' \
                     -derivedDataPath ./build \
                     build

      - name: ğŸ“± Create iOS App Bundle
        run: |
          cd ios
          mkdir -p build/Debug-iphonesimulator
          echo "ğŸ“± iOS Debug app built for simulator"
          echo "ğŸ” App location: ios/build/Build/Products/Debug-iphonesimulator/seraApp.app"

      - name: ğŸ“‹ List build outputs
        run: find ios/build -name "*.app" -type d

      - name: ğŸ“Š Build Info
        run: |
          echo "ğŸ‰ iOS Debug build completed successfully!"
          echo "ğŸ“± Platform: iOS Simulator"
          echo "ğŸ”§ Configuration: Debug"
          echo "ğŸ“ Note: Debug builds are for simulator testing only"
          echo "ğŸ’¡ Tip: Use Xcode or iOS simulator to test the app"
