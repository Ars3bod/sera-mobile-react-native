/*!
 * widgets
 * @version: 9.0.017.00
 * @license: Genesys Telecom Labs
 */
widgetsJsonpFunction([17],{"./node_modules/cometd/cometd.js":function(e,t,n){e.exports=function(){function e(){var e={};self.onmessage=function(t){var n=t.data,r=e[n.id];switch(n.type){case"setTimeout":e[n.id]=self.setTimeout((function(){delete e[n.id],self.postMessage({id:n.id})}),n.delay);break;case"clearTimeout":delete e[n.id],r&&self.clearTimeout(r);break;default:throw"Unknown command "+n.type}}}var t=function(){var e=0,t={};this.register=function(n){var r=++e;return t[r]=n,r},this.unregister=function(e){var n=t[e];return delete t[e],n},this.setTimeout=function(e,t){return window.setTimeout(e,t)},this.clearTimeout=function(e){window.clearTimeout(e)}},n={isString:function(e){return null!=e&&("string"==typeof e||e instanceof String)},isArray:function(e){return null!=e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1}},r=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,s){for(var i=[],a=0;a<e.length;++a){var o=e[a];!0===t[o].accept(n,r,s)&&i.push(o)}return i},this.negotiateTransport=function(n,r,s,i){for(var a=0;a<e.length;++a)for(var o=e[a],c=0;c<n.length;++c)if(o===n[c]){var u=t[o];if(!0===u.accept(r,s,i))return u}return null},this.add=function(n,r,s){for(var i=!1,a=0;a<e.length;++a)if(e[a]===n){i=!0;break}return i||("number"!=typeof s?e.push(n):e.splice(s,0,n),t[n]=r),!i},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var s=t[n];return delete t[n],s}return null},this.clear=function(){e=[],t={}},this.reset=function(n){for(var r=0;r<e.length;++r)t[e[r]].reset(n)}},s=function(){var e,t,r;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return t.setTimeout(e,n)},this.clearTimeout=function(e){t.clearTimeout(e)},this.convertToMessages=function(e){if(n.isString(e))try{return JSON.parse(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(n.isArray(e))return e;if(null==e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return e},this.getURL=function(){return r},this.setURL=function(e){r=e},this.send=function(e,t){throw"Abstract"},this.reset=function(t){this._debug("Transport",e,"reset",t?"initial":"retry")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}};s.derive=function(e){function t(){}return t.prototype=e,new t};var i=function(){function e(e){for(;p.length>0;){var t=p[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;p.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;!0===t.metaConnect&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var s=this;t.timeout=this.setTimeout((function(){t.expired=!0;var n="Request "+t.id+" of transport "+s.getType()+" exceeded "+r+" ms max network delay",i={reason:n},a=t.xhr;i.httpCode=s.xhrStatus(a),s.abortXHR(a),s._debug(n),s.complete(t,!1,t.metaConnect),e.onFailure(a,e.messages,i)}),r)}}function r(e){var n=++l,r={id:n,metaConnect:!1,envelope:e};f.length<this.getConfiguration().maxConnections-1?(f.push(r),t.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),p.push([e,r]))}function i(e){var t=e.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",t),null!==d&&d.id!==t)throw"/meta/connect request mismatch, completing request "+t;d=null}function a(t,s){var i=n.inArray(t,f);if(i>=0&&f.splice(i,1),p.length>0){var a=p.shift(),o=a[0],c=a[1];if(this._debug("Transport dequeued request",c.id),s)this.getConfiguration().autoBatch&&e.call(this,o),r.call(this,o),this._debug("Transport completed request",t.id,o);else{var u=this;this.setTimeout((function(){u.complete(c,!1,c.metaConnect);var e={reason:"Previous request failed"},t=c.xhr;e.httpCode=u.xhrStatus(t),o.onFailure(t,o.messages,e)}),0)}}}function o(e){if(null!==d)throw"Concurrent /meta/connect requests not allowed, request id="+d.id+" not yet completed";var n=++l;this._debug("Transport",this.getType(),"/meta/connect send, request",n,"envelope",e);var r={id:n,metaConnect:!0,envelope:e};t.call(this,e,r),d=r}var c=new s,u=s.derive(c),l=0,d=null,f=[],p=[];return u.complete=function(e,t,n){n?i.call(this,e):a.call(this,e,t)},u.transportSend=function(e,t){throw"Abstract"},u.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},u.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},u.send=function(e,t){t?o.call(this,e):r.call(this,e)},u.abort=function(){c.abort();for(var e=0;e<f.length;++e){var t=f[e];t&&(this._debug("Aborting request",t),this.abortXHR(t.xhr)||this.transportFailure(t.envelope,t,{reason:"abort"}))}var n=d;n&&(this._debug("Aborting /meta/connect request",n),this.abortXHR(n.xhr)||this.transportFailure(n.envelope,n,{reason:"abort"})),this.reset(!0)},u.reset=function(e){c.reset(e),d=null,f=[],p=[]},u.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==window.XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},u.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},u},a=function(){var e=new i,t=s.derive(e),n=!0;return t.accept=function(e,t,r){return n||!t},t.newXMLHttpRequest=function(){return new window.XMLHttpRequest},t.xhrSend=function(e){var n=t.newXMLHttpRequest();n.context=t.context,n.withCredentials=!0,n.open("POST",e.url,!0!==e.sync);var r=e.headers;if(r)for(var s in r)r.hasOwnProperty(s)&&n.setRequestHeader(s,r[s]);return n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onload=function(){200===n.status?e.onSuccess(n.responseText):e.onError(n.statusText)},n.onerror=function(){e.onError(n.statusText)},n.send(e.body),n},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var r=this;try{var s=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(e.messages),onSuccess:function(s){r._debug("Transport",r.getType(),"received response",s);var i=!1;try{var a=r.convertToMessages(s);0===a.length?(n=!1,r.transportFailure(e,t,{httpCode:204})):(i=!0,r.transportSuccess(e,t,a))}catch(s){if(r._debug(s),!i){n=!1;var o={exception:s};o.httpCode=r.xhrStatus(t.xhr),r.transportFailure(e,t,o)}}},onError:function(i,a){r._debug("Transport",r.getType(),"received error",i,a),n=!1;var o={reason:i,exception:a};o.httpCode=r.xhrStatus(t.xhr),s?r.setTimeout((function(){r.transportFailure(e,t,o)}),0):r.transportFailure(e,t,o)}}),s=!1}catch(s){n=!1,this.setTimeout((function(){r.transportFailure(e,t,{exception:s})}),0)}},t.reset=function(t){e.reset(t),n=!0},t},o=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new i,n=s.derive(t),r=0;return n.accept=function(e,t,n){return!0},n.jsonpSend=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),s="_cometd_jsonp_"+r++;window[s]=function(r){t.removeChild(n),delete window[s],e.onSuccess(r)};var i=e.url;i+=i.indexOf("?")<0?"?":"&",i+="jsonp="+s,i+="&message="+encodeURIComponent(e.body),n.src=i,n.async=!0!==e.sync,n.type="application/javascript",n.onerror=function(t){e.onError("jsonp "+t.type)},t.appendChild(n)},n.transportSend=function(t,n){for(var r=this,s=0,i=t.messages.length,a=[];i>0;){var o=JSON.stringify(t.messages.slice(s,s+i)),c=t.url.length+encodeURI(o).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===i){var l="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,l),0)}--i}else a.push(i),s+=i,i=t.messages.length-s}var d=t;if(a.length>1){var f=0,p=a[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",a.join(" + ")),(d=this._mixin(!1,{},t)).messages=t.messages.slice(f,p),d.onSuccess=t.onSuccess,d.onFailure=t.onFailure;for(var g=1;g<a.length;++g){var h=this._mixin(!1,{},t);f=p,p+=a[g],h.messages=t.messages.slice(f,p),h.onSuccess=t.onSuccess,h.onFailure=t.onFailure,this.send(h,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",d);try{var m=!0;this.jsonpSend({transport:this,url:d.url,sync:d.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(d.messages),onSuccess:function(e){var t=!1;try{var s=r.convertToMessages(e);0===s.length?r.transportFailure(d,n,{httpCode:204}):(t=!0,r.transportSuccess(d,n,s))}catch(e){r._debug(e),t||r.transportFailure(d,n,{exception:e})}},onError:function(e,t){var s={reason:e,exception:t};m?r.setTimeout((function(){r.transportFailure(d,n,s)}),0):r.transportFailure(d,n,s)}}),m=!1}catch(e){this.setTimeout((function(){r.transportFailure(d,n,{exception:e})}),0)}},n},c=function(){function e(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function t(e){return e===h||e===g}function r(e,t,n){for(var r=[],s=0;s<t.messages.length;++s){var i=t.messages[s];i.id&&r.push(i.id)}e.envelopes[r.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function i(n){if(!h){var r=c.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",r);try{var s=c.getConfiguration().protocol;n.webSocket=s?new window.WebSocket(r,s):new window.WebSocket(r),h=n}catch(e){throw d=!1,this._debug("Exception while creating WebSocket object",e),e}p=!1!==c.getConfiguration().stickyReconnect;var i=this,a=c.getConfiguration().connectTimeout;a>0&&(n.connectTimer=this.setTimeout((function(){c._debug("Transport",i.getType(),"timed out while connecting to URL",r,":",a,"ms"),e.call(i,n,{code:1e3,reason:"Connect Timeout"})}),a));var o=function(e){e=e||{code:1e3},c._debug("WebSocket onclose",n,e,"connecting",h,"current",g),n.connectTimer&&i.clearTimeout(n.connectTimer),i.onClose(n,e)};n.webSocket.onopen=function(){c._debug("WebSocket onopen",n),n.connectTimer&&i.clearTimeout(n.connectTimer),t(n)?(h=null,g=n,f=!0,i.onOpen(n)):(c._warn("Closing extra WebSocket connection",this,"active connection",g),e.call(i,n,{code:1e3,reason:"Extra Connection"}))},n.webSocket.onclose=o,n.webSocket.onerror=function(){o({code:1e3,reason:"Error"})},n.webSocket.onmessage=function(e){c._debug("WebSocket onmessage",e,n),i.onMessage(n,e)},this._debug("Transport",this.getType(),"configured callbacks on",n)}}function a(t,n,r){var s=JSON.stringify(n.messages);t.webSocket.send(s),this._debug("Transport",this.getType(),"sent",n,"/meta/connect =",r);var i=this.getConfiguration().maxNetworkDelay,a=i;r&&(a+=this.getAdvice().timeout,m=!0);for(var o=this,u=[],l=0;l<n.messages.length;++l)!function(){var r=n.messages[l];r.id&&(u.push(r.id),t.timeouts[r.id]=o.setTimeout((function(){c._debug("Transport",o.getType(),"timing out message",r.id,"after",a,"on",t),e.call(o,t,{code:1e3,reason:"Message Timeout"})}),a))}();this._debug("Transport",this.getType(),"waiting at most",a,"ms for messages",u,"maxNetworkDelay",i,", timeouts:",t.timeouts)}function o(t,n,s){try{null===t?(t=h||{envelopes:{},timeouts:{}},r.call(this,t,n,s),i.call(this,t)):(r.call(this,t,n,s),a.call(this,t,n,s))}catch(n){var o=this;this.setTimeout((function(){e.call(o,t,{code:1e3,reason:"Exception",exception:n})}),0)}}var c,u=new s,l=s.derive(u),d=!0,f=!1,p=!0,g=null,h=null,m=!1,v=null;return l.reset=function(e){u.reset(e),d=!0,e&&(f=!1),p=!0,g=null,h=null,m=!1},l._notifySuccess=function(e,t){e.call(this,t)},l._notifyFailure=function(e,t,n,r){e.call(this,t,n,r)},l.onOpen=function(e){var t=e.envelopes;for(var n in this._debug("Transport",this.getType(),"opened",e,"pending messages",t),t)if(t.hasOwnProperty(n)){var r=t[n],s=r[0],i=r[1];v=s.onSuccess,a.call(this,e,s,i)}},l.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var r=!1,s=this.convertToMessages(t.data),i=[],a=0;a<s.length;++a){var o=s[a];if((/^\/meta\//.test(o.channel)||void 0===o.data)&&o.id){i.push(o.id);var c=e.timeouts[o.id];c&&(this.clearTimeout(c),delete e.timeouts[o.id],this._debug("Transport",this.getType(),"removed timeout for message",o.id,", timeouts",e.timeouts))}"/meta/connect"===o.channel&&(m=!1),"/meta/disconnect"!==o.channel||m||(r=!0)}for(var u=!1,l=e.envelopes,d=0;d<i.length;++d){var f=i[d];for(var p in l)if(l.hasOwnProperty(p)){var g=p.split(","),h=n.inArray(f,g);if(h>=0){u=!0,g.splice(h,1);var y=l[p][0],b=l[p][1];delete l[p],g.length>0&&(l[g.join(",")]=[y,b]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",l),this._notifySuccess(v,s),r&&this.webSocketClose(e,1e3,"Disconnect")},l.onClose=function(e,n){this._debug("Transport",this.getType(),"closed",e,n),t(e)&&(d=p&&f,h=null,g=null);var r=e.timeouts;for(var s in e.timeouts={},r)r.hasOwnProperty(s)&&this.clearTimeout(r[s]);var i=e.envelopes;for(var a in e.envelopes={},i)if(i.hasOwnProperty(a)){var o=i[a][0];i[a][1]&&(m=!1);var c={websocketCode:n.code,reason:n.reason};n.exception&&(c.exception=n.exception),this._notifyFailure(o.onFailure,e,o.messages,c)}},l.registered=function(e,t){u.registered(e,t),c=t},l.accept=function(e,t,n){return this._debug("Transport",this.getType(),"accept, supported:",d),d&&!!window.WebSocket&&!1!==c.websocketEnabled},l.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"/meta/connect =",t),o.call(this,g,e,t)},l.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},l.abort=function(){u.abort(),e.call(this,g,{code:1e3,reason:"Abort"}),this.reset(!0)},l},u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],l=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(s){function i(e,t){try{return e[t]}catch(e){return}}function u(e){return n.isString(e)}function l(e){return null!=e&&"function"==typeof e}function d(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+e}function f(e,t){if(window.console){var n=window.console[e];if(l(n)){var r=new Date;[].splice.call(t,0,0,d(r.getHours(),2)+":"+d(r.getMinutes(),2)+":"+d(r.getSeconds(),2)+"."+d(r.getMilliseconds(),3)),n.apply(window.console,t)}}}function p(e){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(e)}function g(t){ue._debug("Configuring cometd object with",t),u(t)&&(t={url:t}),t||(t={}),Pe=ue._mixin(!1,Pe,t);var n=ue.getURL();if(!n)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var r=p(n),s=r[2],i=r[8],a=r[9];if(de=ue._isCrossDomain(s),Pe.appendMessageTypeToURL)if(void 0!==a&&a.length>0)ue._info("Appending message type to URI "+i+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Pe.appendMessageTypeToURL=!1;else{var o=i.split("/"),c=o.length-1;i.match(/\/$/)&&(c-=1),o[c].indexOf(".")>=0&&(ue._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Pe.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&Pe.useWorkerScheduler){var l=e.toString();l=l.substring(l.indexOf("{")+1,l.lastIndexOf("}"));var d=new window.Blob([l],{type:"application/json"}),f=window.URL.createObjectURL(d),g=new window.Worker(f);ce.setTimeout=function(e,t){var n=ce.register(e);return g.postMessage({id:n,type:"setTimeout",delay:t}),n},ce.clearTimeout=function(e){ce.unregister(e),g.postMessage({id:e,type:"clearTimeout"})},g.onmessage=function(e){var t=e.data.id,n=ce.unregister(t);n&&n()}}}function h(e){if(e){var t=Te[e.channel];t&&t[e.id]&&(delete t[e.id],ue._debug("Removed",e.listener?"listener":"subscription",e))}}function m(e){e&&!e.listener&&h(e)}function v(){for(var e in Te)if(Te.hasOwnProperty(e)){var t=Te[e];if(t)for(var n in t)t.hasOwnProperty(n)&&m(t[n])}}function y(e){pe!==e&&(ue._debug("Status",pe,"->",e),pe=e)}function b(){return"disconnecting"===pe||"disconnected"===pe}function T(){return""+ ++ge}function w(e,t,n,r,s){try{return t.call(e,r)}catch(e){var i=ue.onExtensionException;if(l(i)){ue._debug("Invoking extension exception handler",n,e);try{i.call(ue,e,n,s,r)}catch(e){ue._info("Exception during execution of extension exception handler",n,e)}}else ue._info("Exception during execution of extension",n,e);return r}}function x(e){for(var t=ke.length-1;t>=0&&null!=e;--t){var n=ke[t],r=n.extension.outgoing;if(l(r)){var s=w(n.extension,r,n.name,e,!0);e=void 0===s?e:s}}return e}function k(e,t){var n=Te[e];if(n)for(var r in n)if(n.hasOwnProperty(r)){var s=n[r];if(s)try{s.callback.call(s.scope,t)}catch(e){var i=ue.onListenerException;if(l(i)){ue._debug("Invoking listener exception handler",s,e);try{i.call(ue,e,s,s.listener,t)}catch(e){ue._info("Exception during execution of listener exception handler",s,e)}}else ue._info("Exception during execution of listener",s,t,e)}}}function S(e,t){k(e,t);for(var n=e.split("/"),r=n.length-1,s=r;s>0;--s){var i=n.slice(0,s).join("/")+"/*";s===r&&k(i,t),k(i+="*",t)}}function C(){null!==xe&&ue.clearTimeout(xe),xe=null}function _(e,t){C();var n=Se.interval+t;ue._debug("Function scheduled in",n,"ms, interval =",Se.interval,"backoff =",we,e),xe=ue.setTimeout(e,n)}function I(e,t,n){for(var r=0;r<e.length;++r){var s=e[r],i=s.id;he&&(s.clientId=he),null!=(s=x(s))?(s.id=i,e[r]=s):(delete Ce[i],e.splice(r--,1))}if(0!==e.length){t&&(Oe=e[0]);var a=ue.getURL();Pe.appendMessageTypeToURL&&(a.match(/\/$/)||(a+="/"),n&&(a+=n));var o={url:a,sync:!1,messages:e,onSuccess:function(e){try{ae.call(ue,e)}catch(e){ue._info("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var r=ue.getTransport();n.connectionType=r?r.getType():"unknown",oe.call(ue,e,t,n)}catch(e){ue._info("Exception during handling of failure",e)}}};ue._debug("Send",o),re.send(o,t)}}function D(e){me>0||!0===ye?ve.push(e):I([e],!1)}function j(){we=0}function R(){var e=ve;ve=[],e.length>0&&I(e,!1)}function O(e){y("connecting"),_((function(){!function(){if(!b()){var e={id:T(),channel:"/meta/connect",connectionType:re.getType()};De||(e.advice={timeout:0}),y("connecting"),ue._debug("Connect sent",e),I([e],!0,"connect"),y("connected")}}()}),e)}function P(e){e&&(Se=ue._mixin(!1,{},Pe.advice,e),ue._debug("New advice",Se))}function A(e){if(C(),e&&re&&re.abort(),de=!1,re=null,y("disconnected"),he=null,me=0,j(),Ie=!1,De=!1,je=0,Oe=null,ve.length>0){var t=ve;ve=[],oe.call(ue,void 0,t,{reason:"Disconnected"})}}function L(e,t,n){var r=ue.onTransportException;if(l(r)){ue._debug("Invoking transport exception handler",e,t,n);try{r.call(ue,n,e,t)}catch(e){ue._info("Exception during execution of transport exception handler",e)}}}function M(e,t){l(e)&&(t=e,e=void 0),he=null,v(),b()&&fe.reset(!0),P({}),me=0,ye=!0,se=e,ie=t;var n=ue.getURL(),r=fe.findTransportTypes("1.0",de,n),s={id:T(),version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:r,advice:{timeout:Se.timeout,interval:Se.interval}},i=ue._mixin(!1,{},se,s);if(ue._putCallback(i.id,t),!re&&!(re=fe.negotiateTransport(r,"1.0",de,n))){var a="Could not find initial transport among: "+fe.getTransportTypes();throw ue._warn(a),a}ue._debug("Initial transport is",re.getType()),y("handshaking"),ue._debug("Handshake sent",i),I([i],!1,"handshake")}function E(e,t){try{e.call(ue,t)}catch(e){var n=ue.onCallbackException;if(l(n)){ue._debug("Invoking callback exception handler",e);try{n.call(ue,e,t)}catch(e){ue._info("Exception during execution of callback exception handler",e)}}else ue._info("Exception during execution of message callback",e)}}function U(e){var t=ue._getCallback([e.id]);l(t)&&(delete Ce[e.id],E(t,e))}function q(e){var t=_e[e.id];if(delete _e[e.id],t){ue._debug("Handling remote call response for",e,"with context",t);var n=t.timeout;n&&ue.clearTimeout(n);var r=t.callback;if(l(r))return E(r,e),!0}return!1}function N(e){ue._debug("Transport failure handling",e),e.transport&&(re=e.transport),e.url&&re.setURL(e.url);var t=e.action,n=e.delay||0;switch(t){case"handshake":!function(e){y("handshaking"),ye=!0,_((function(){M(se,ie)}),e)}(n);break;case"retry":O(n);break;case"none":A(!0);break;default:throw"Unknown action "+t}}function F(e,t){U(e),S("/meta/handshake",e),S("/meta/unsuccessful",e),b()&&(t.action="none"),ue.onTransportFailure.call(ue,e,t,N)}function K(e){F(e,{cause:"failure",action:"handshake",transport:null})}function B(e){return"disconnected"===pe||!(!Oe||Oe.id!==e.id)&&(Oe=null,!0)}function H(e,t){S("/meta/connect",e),S("/meta/unsuccessful",e),b()&&(t.action="none"),ue.onTransportFailure.call(ue,e,t,N)}function W(e){B(e)?(De=!1,H(e,{cause:"failure",action:"retry",transport:null})):ue._debug("Mismatched /meta/connect failure",e)}function J(e){A(!0),U(e),S("/meta/disconnect",e),S("/meta/unsuccessful",e)}function z(e){J(e)}function X(e){var t=Te[e.subscription];if(t)for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r&&!r.listener&&(delete t[n],ue._debug("Removed failed subscription",r))}U(e),S("/meta/subscribe",e),S("/meta/unsuccessful",e)}function G(e){X(e)}function V(e){U(e),S("/meta/unsubscribe",e),S("/meta/unsuccessful",e)}function $(e){V(e)}function Z(e){q(e)||(U(e),S("/meta/publish",e),S("/meta/unsuccessful",e))}function Y(e){Z(e)}function Q(e){if(je=0,void 0!==(e=function(e){for(var t=0;t<ke.length&&null!=e;++t){var n=ke[t],r=n.extension.incoming;if(l(r)){var s=w(n.extension,r,n.name,e,!1);e=void 0===s?e:s}}return e}(e))&&null!==e)switch(P(e.advice),e.channel){case"/meta/handshake":!function(e){var t=ue.getURL();if(e.successful){var n=ue._isCrossDomain(p(t)[2]),r=fe.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(null===r)return e.successful=!1,void F(e,{cause:"negotiation",action:"none",transport:null});re!==r&&(ue._debug("Transport",re.getType(),"->",r.getType()),re=r),he=e.clientId,ye=!1,R(),e.reestablish=Ie,Ie=!0,U(e),S("/meta/handshake",e),Re=e["x-messages"]||0;var s=b()?"none":Se.reconnect||"retry";switch(s){case"retry":j(),0===Re?O(0):ue._debug("Processing",Re,"handshake-delivered messages");break;case"none":A(!0);break;default:throw"Unrecognized advice action "+s}}else F(e,{cause:"unsuccessful",action:Se.reconnect||"handshake",transport:re})}(e);break;case"/meta/connect":!function(e){if(B(e))if(De=e.successful){S("/meta/connect",e);var t=b()?"none":Se.reconnect||"retry";switch(t){case"retry":j(),O(we);break;case"none":A(!1);break;default:throw"Unrecognized advice action "+t}}else H(e,{cause:"unsuccessful",action:Se.reconnect||"retry",transport:re});else ue._debug("Mismatched /meta/connect reply",e)}(e);break;case"/meta/disconnect":!function(e){e.successful?(A(!1),U(e),S("/meta/disconnect",e)):J(e)}(e);break;case"/meta/subscribe":!function(e){e.successful?(U(e),S("/meta/subscribe",e)):X(e)}(e);break;case"/meta/unsubscribe":!function(e){e.successful?(U(e),S("/meta/unsubscribe",e)):V(e)}(e);break;default:!function(e){void 0!==e.data?q(e)||(S(e.channel,e),Re>0&&0==--Re&&(ue._debug("Processed last handshake-delivered message"),O(0))):void 0===e.successful?ue._warn("Unknown Bayeux Message",e):e.successful?(U(e),S("/meta/publish",e)):Z(e)}(e)}}function ee(e){var t=Te[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0;return!1}function te(e,t){var n={scope:e,method:t};if(l(e))n.scope=void 0,n.method=e;else if(u(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!l(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!l(t))throw"Invalid callback "+t;return n}function ne(e,t,n,r){var s=te(t,n);ue._debug("Adding",r?"listener":"subscription","on",e,"with scope",s.scope,"and callback",s.method);var i=++be,a={id:i,channel:e,scope:s.scope,callback:s.method,listener:r},o=Te[e];return o||(o={},Te[e]=o),o[i]=a,ue._debug("Added",r?"listener":"subscription",a),a}var re,se,ie,ae,oe,ce=new t,ue=this,le=s||"default",de=!1,fe=new r,pe="disconnected",ge=0,he=null,me=0,ve=[],ye=!1,be=0,Te={},we=0,xe=null,ke=[],Se={},Ce={},_e={},Ie=!1,De=!1,je=0,Re=0,Oe=null,Pe={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(e,t,n){for(var r=t||{},s=2;s<arguments.length;++s){var a=arguments[s];if(null!=a)for(var o in a)if(a.hasOwnProperty(o)){var c=i(a,o),u=i(r,o);if(c===t)continue;if(void 0===c)continue;if(e&&"object"==typeof c&&null!==c)if(c instanceof Array)r[o]=this._mixin(e,u instanceof Array?u:[],c);else{var l="object"!=typeof u||u instanceof Array?{}:u;r[o]=this._mixin(e,l,c)}else r[o]=c}}return r},this._warn=function(){f("warn",arguments)},this._info=function(){"warn"!==Pe.logLevel&&f("info",arguments)},this._debug=function(){"debug"===Pe.logLevel&&f("debug",arguments)},this._isCrossDomain=function(e){return!!(window.location&&window.location.host&&e)&&e!==window.location.host},this.send=D,this._getCallback=function(e){return Ce[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return l(t)&&(Ce[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var r=this.getTransportRegistry(),s=this.getURL(),i=this._isCrossDomain(p(s)[2]),a=r.findTransportTypes("1.0",i,s);if("none"===t.action){if("/meta/handshake"===e.channel&&!t.transport){var o="Could not negotiate transport, client=["+a+"], server=["+e.supportedConnectionTypes+"]";this._warn(o),L(re.getType(),null,{reason:o,connectionType:re.getType(),transport:re})}}else if(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel){if(!t.transport){var c=r.negotiateTransport(a,"1.0",i,s);c?(this._debug("Transport",re.getType(),"->",c.getType()),L(re.getType(),c.getType(),e.failure),t.action="handshake",t.transport=c):(this._warn("Could not negotiate transport, client=["+a+"]"),L(re.getType(),null,e.failure),t.action="none")}"none"!==t.action&&this.increaseBackoffPeriod()}else{var u=(new Date).getTime();if(0===je&&(je=u),"retry"===t.action){t.delay=this.increaseBackoffPeriod();var l=Se.maxInterval;if(l>0){var d=Se.timeout+Se.interval+l;u-je+we>d&&(t.action="handshake")}}"handshake"===t.action&&(t.delay=0,r.reset(!1),this.resetBackoffPeriod())}n.call(ue,t)},this.receive=Q,ae=function(e){ue._debug("Received",e);for(var t=0;t<e.length;++t)Q(e[t])},oe=function(e,t,n){ue._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var s=t[r],i={id:s.id,successful:!1,channel:s.channel,failure:n};switch(n.message=s,s.channel){case"/meta/handshake":K(i);break;case"/meta/connect":W(i);break;case"/meta/disconnect":z(i);break;case"/meta/subscribe":i.subscription=s.subscription,G(i);break;case"/meta/unsubscribe":i.subscription=s.subscription,$(i);break;default:Y(i)}}},this.registerTransport=function(e,t,n){var r=fe.add(e,t,n);return r&&(this._debug("Registered transport",e),l(t.registered)&&t.registered(e,this)),r},this.unregisterTransport=function(e){var t=fe.remove(e);return null!==t&&(this._debug("Unregistered transport",e),l(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){fe.clear()},this.getTransportTypes=function(){return fe.getTransportTypes()},this.findTransport=function(e){return fe.find(e)},this.getTransportRegistry=function(){return fe},this.configure=function(e){g.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){if("disconnected"!==pe)throw"Illegal state: handshaken";M(e,t)},this.disconnect=function(e,t){if(!b()){l(e)&&(t=e,e=void 0);var n={id:T(),channel:"/meta/disconnect"},r=this._mixin(!1,{},e,n);ue._putCallback(r.id,t),y("disconnecting"),I([r],!1,"disconnect")}},this.startBatch=function(){++me,ue._debug("Starting batch, depth",me)},this.endBatch=function(){!function(){if(--me,ue._debug("Ending batch, depth",me),me<0)throw"Calls to startBatch() and endBatch() are not paired";0!==me||b()||ye||R()}()},this.batch=function(e,t){var n=te(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";return ne(e,t,n,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;h(e)},this.clearListeners=function(){Te={}},this.subscribe=function(e,t,n,r,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(b())throw"Illegal state: disconnected";l(t)&&(s=r,r=n,n=t,t=void 0),l(r)&&(s=r,r=void 0);var i=!ee(e),a=ne(e,t,n,!1);if(i){var o={id:T(),channel:"/meta/subscribe",subscription:e},c=this._mixin(!1,{},r,o);ue._putCallback(c.id,s),D(c)}return a},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(b())throw"Illegal state: disconnected";l(t)&&(n=t,t=void 0),this.removeListener(e);var r=e.channel;if(!ee(r)){var s={id:T(),channel:"/meta/unsubscribe",subscription:r},i=this._mixin(!1,{},t,s);ue._putCallback(i.id,n),D(i)}},this.resubscribe=function(e,t){if(m(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){v()},this.publish=function(e,t,n,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(b())throw"Illegal state: disconnected";l(t)?(r=t,t={},n=void 0):l(n)&&(r=n,n=void 0);var s={id:T(),channel:e,data:t},i=this._mixin(!1,{},n,s);ue._putCallback(i.id,r),D(i)},this.publishBinary=function(e,t,n,r,s){l(t)?(s=t,t=new ArrayBuffer(0),n=!0,r=void 0):l(n)?(s=n,n=!0,r=void 0):l(r)&&(s=r,r=void 0);var i={meta:r,data:t,last:n};this.publish(e,i,{ext:{binary:{}}},s)},this.remoteCall=function(e,t,n,r,s){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: target must be a string";if(b())throw"Illegal state: disconnected";if(l(t)?(s=t,t={},n=Pe.maxNetworkDelay,r=void 0):l(n)?(s=n,n=Pe.maxNetworkDelay,r=void 0):l(r)&&(s=r,r=void 0),"number"!=typeof n)throw"Illegal argument type: timeout must be a number";e.match(/^\//)||(e="/"+e);var i="/service"+e,a={id:T(),channel:i,data:t},o=this._mixin(!1,{},r,a),c={callback:s};n>0&&(c.timeout=ue.setTimeout((function(){ue._debug("Timing out remote call",o,"after",n,"ms"),Z({id:o.id,error:"406::timeout",successful:!1,failure:{message:o,reason:"Remote Call Timeout"}})}),n),ue._debug("Scheduled remote call timeout",o,"in",n,"ms")),_e[o.id]=c,D(o)},this.remoteCallBinary=function(e,t,n,r,s,i){l(t)?(i=t,t=new ArrayBuffer(0),n=!0,r=void 0,s=Pe.maxNetworkDelay):l(n)?(i=n,n=!0,r=void 0,s=Pe.maxNetworkDelay):l(r)?(i=r,r=void 0,s=Pe.maxNetworkDelay):l(s)&&(i=s,s=Pe.maxNetworkDelay);var a={meta:r,data:t,last:n};this.remoteCall(e,a,s,{ext:{binary:{}}},i)},this.getStatus=function(){return pe},this.isDisconnected=b,this.setBackoffIncrement=function(e){Pe.backoffIncrement=e},this.getBackoffIncrement=function(){return Pe.backoffIncrement},this.getBackoffPeriod=function(){return we},this.increaseBackoffPeriod=function(){return we<Pe.maxBackoff&&(we+=Pe.backoffIncrement),we},this.resetBackoffPeriod=function(){j()},this.setLogLevel=function(e){Pe.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,r=0;r<ke.length;++r)if(ke[r].name===e){n=!0;break}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(ke.push({name:e,extension:t}),this._debug("Registered extension",e),l(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!u(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<ke.length;++n){var r=ke[n];if(r.name===e){ke.splice(n,1),t=!0,this._debug("Unregistered extension",e);var s=r.extension;l(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<ke.length;++t){var n=ke[t];if(n.name===e)return n.extension}return null},this.getName=function(){return le},this.getClientId=function(){return he},this.getURL=function(){if(re){var e=re.getURL();if(e)return e;if(e=Pe.urls[re.getType()])return e}return Pe.url},this.getTransport=function(){return re},this.getConfiguration=function(){return this._mixin(!0,{},Pe)},this.getAdvice=function(){return this._mixin(!0,{},Se)},this.setTimeout=function(e,t){return ce.setTimeout((function(){try{ue._debug("Invoking timed function",e),e()}catch(t){ue._debug("Exception invoking timed function",e,t)}}),t)},this.clearTimeout=function(e){ce.clearTimeout(e)},window.WebSocket&&this.registerTransport("websocket",new c),this.registerTransport("long-polling",new a),this.registerTransport("callback-polling",new o)},Transport:s,RequestTransport:i,LongPollingTransport:a,CallbackPollingTransport:o,WebSocketTransport:c,Utils:n,Z85:{encode:function(e){var t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;for(var n=t.byteLength,r=n%4,s=4-(0===r?4:r),i=new DataView(t),a="",o=0,c=0;c<n+s;++c){var l=c>=n;if(o=256*o+(l?0:i.getUint8(c)),(c+1)%4==0){for(var d=52200625,f=5;f>0;--f){if(!l||f>s){var p=Math.floor(o/d)%85;a+=u[p]}d/=85}o=0}}return a},decode:function(e){for(var t=e.length%5,n=5-(0===t?5:t),r=0;r<n;++r)e+=u[u.length-1];for(var s=e.length,i=new ArrayBuffer(4*s/5-n),a=new DataView(i),o=0,c=0,d=0,f=0;f<s;++f){var p=e.charCodeAt(c++)-32;if(o=85*o+l[p],c%5==0){for(var g=16777216;g>=1;)d<a.byteLength&&a.setUint8(d++,Math.floor(o/g)%256),g/=256;o=0}}return i}}}}()},"./webapp/lib/thirdparty/jquery.cometd.js":function(e,t,n){"use strict";var r,s,i,a,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e,t){function n(e,t){if(t)for(var n in t)if(t.hasOwnProperty(n)){if("content-type"===n.toLowerCase())continue;e.setRequestHeader(n,t[n])}}function r(){var r=new t.LongPollingTransport,s=t.Transport.derive(r);return s.xhrSend=function(t){return e.ajax({url:t.url,async:!0!==t.sync,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},s}function s(){var r=new t.CallbackPollingTransport,s=t.Transport.derive(r);return s.jsonpSend=function(t){e.ajax({url:t.url,async:!0!==t.sync,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},s}return e.CometD=function(e){var n=new t.CometD(e);return n.unregisterTransports(),window.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new s),n},e.cometd=new e.CometD,e.cometd},"object"===o(t)?e.exports=a(n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/cometd/cometd.js")):(s=[n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/cometd/cometd.js")],void 0!==(i="function"==typeof(r=a)?r.apply(t,s):r)&&(e.exports=i))},"./webapp/plugins/cx-webchat-service/controllers/legacy-controller.js":function(t,n,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=s(r("./node_modules/jquery/dist/jquery.js")),c=s(r("./webapp/plugins/cx-common/cx-common.js")),u=s(r("./node_modules/js-cookie/src/js.cookie.js"));s((s(r("./node_modules/cometd/cometd.js")),r("./webapp/lib/thirdparty/jquery.cometd.js"))),CXBus.registerModule("webchatservicelegacy",(function(){function t(){n.registerEvents(["ready","restored","restoreTimeout","restoreFailed","messageReceived","error","started","ended","agentTypingStarted","agentTypingStopped","pollingStarted","pollingStopped","clientConnected","clientDisconnected","agentConnected","agentDisconnected","supervisorConnected","supervisorDisconnected","botConnected","botDisconnected","clientTypingStarted","clientTypingStopped","ajaxResponse","disconnected","reconnected","chatServerWentOffline","chatServerBackOnline","sleeping","waking"]);var t=setInterval,r=!1,s=3e3,l=3e3,d=3e3,f=500,p=1.2,g=3e4,h=0,m=0,v=5,y=!1,b=!0,T=!0,w=3e3,x=0,k={withCredentials:!1},S=!1,C={sessionID:"",userId:"",secureKey:"",alias:""},_="",I="_genesys.widgets.webchat.state",D=I+".session",j=I+".keys",R=I+".ping",O=I+".filters",P=1,A=!1,L=!1,M=!1,E=!1,U=!1,q=6e4,N="",F="",K=c.default.getBrowserandOS(),B=[],H=[],W={},J={},z=!1,X=!1,G=!1,V={enabled:!1,cometURL:"",channel:"/service/chatV2/customer-support",apiURL:"",websocketEnabled:!0,logLevel:"info"},$=!1,Z=0,Y=!1,Q=!1,ee=!1,te=!1,ne={Timer:0,Timeout:2e3,TimeInterval:100,Interval:!1,IdleCount:0,IdleLimit:2,Text:""},re={standard:[/\{start\:[0-9]{9}\}/],custom:[]},se=[],ie=!1,ae=!1,oe=!1,ce={enabled:!1,maxMessagePageSize:20},ue=!1,le=!1,de=!1,fe=!1,pe="",ge=["Authorization"];n.data("sleeping",!1);var he=function(e,t,r){if(U)return!1;var s=o.default.Deferred(),i={alias:C.alias,secureKey:C.secureKey,userId:C.userId};r=r||{};if(r=o.default.extend(i,r),X)X&&(""==e?(e="requestChat",ie=s):L&&(ie=s),$?me(e,t,r,s):(Le(),c.default.watch((function(){return $}),250).done((function(){me(e,t,r)}))));else{var a=S?c.default.filterObjectProperties(n.data("App.requestHeader"),ge):{};"disconnect"==e&&(ae=s),c.default.request({url:N+C.sessionID+(e?"/"+e:""),type:t,crossDomain:!0,data:r,timeout:w,cache:!1,headers:o.default.extend({},{"Content-Type":"application/x-www-form-urlencoded"},a),xhrFields:k,success:function(e){if(U)return!1;e.id&&(e.sessionId=e.id),je(e),s.resolve(e||{}),E&&(E=!1,n.publish("reconnected")),2===e.statusCode&&e.errors&&e.errors.length>0&&n.publish("error",e),n.publishDirect("ajaxResponse",e)},error:function(t){if(U)return!1;0===t.status&&(E=!0,A?n.publish("disconnected"):n.publish("error",t));var r=t.responseJSON||{};if("refresh"==e&&r.errors&&r.errors.length>0)for(var i=0;i<r.errors.length;i++)204==r.errors[i].code&&r.errors.splice(i,1);r.errors&&r.errors.length>0&&n.publish("error",t),s.reject(t||{})},beforeSend:function(e){_&&e.setRequestHeader("apikey",_)}})}return s.promise()},me=function(e,t,n,r){if(X&&G&&$){"send"==e&&(e="sendMessage");var s={operation:e,chatId:C.sessionID},i=o.default.extend(s,n);G.publish(V.channel,i),r&&r.resolve({statusCode:0})}else r&&r.reject("CometD is not configured or there is a connection issue")},ve=function(t,r){var s=o.default.Deferred(),i=r.file;if(Re()){var a=new FormData,u=N+C.sessionID+(t||"");i&&a.append("file",i),X?(u=V.apiURL,a.append("operation",t)):(a.append("alias",C.alias),a.append("userId",C.userId)),a.append("secureKey",C.secureKey),c.default.request({type:"POST",url:u,mimeType:"multipart/form-data",contentType:!1,crossDomain:!0,headers:S?c.default.filterObjectProperties(n.data("App.requestHeader"),ge):{},timeout:x,processData:!1,data:a,beforeSend:function(e){_&&e.setRequestHeader("apikey",_)},success:function(e){e.id&&(e.sessionId=e.id),je(e),s.resolve(e||{}),E&&(E=!1,n.publish("disconnected")),n.publishDirect("ajaxResponse",e)},error:function(e){if(o.default.isEmptyObject(i))n.publish("error",e);else if(400===e.status){var t=JSON.parse(e.responseText);o.default.each(t.errors,(function(){this.filename=i.name})),e.responseText=JSON.stringify(t),n.publish("error",e),s.reject(e||{})}else 0===e.status&&(e.errorReason="FileUploadError",e.filename=i.name,e.file=i,n.publish("error",e));s.reject(e||{})}})}else e.deferred.reject("No HTMl5 formData support on your browser");return s.promise()},ye=function(){U=!0,n.command("stopPoll"),xe(),De(),A=!1,Be(),n.publish("ended"),n.command("App.deregisterAutoLoad")},be=function(e){var t=[];o.default.each(e.messages||[],(function(){if(ke(this.index))if("Message"!=this.type||Ce(this.text)){for(var e=this,n=0;n<se.length;n++)e=se[n](e)||e;e=Te(this),we(e),t.push(e),B.push(e),H.push(this)}else{we(this)}})),t.length>0&&(de&&t.sort((function(e,t){return t.index-e.index})),n.publish("messageReceived",{originalMessages:e.messages,messages:t,restoring:L,sessionData:C,oldMessages:de,idleTimeCountDown:e.idleTimerExpire})),ue&&pe<=1&&(fe=!0),!0===e.chatEnded&&!0===A&&ye()},Te=function(e){var t={},n=c.default.checkPath(e,"eventAttributes.structured-content.genesys-chat.content"),r=c.default.checkPath(e,"eventAttributes.GCTI_SYSTEM.party-info.style");if("string"==typeof n)try{n=JSON.parse(n)}catch(e){}if("string"==typeof r)try{r=JSON.parse(r)}catch(e){}return"TypingStarted"==e.type?t.isTyping=!0:"TypingStopped"==e.type&&(t.isTyping=!1),"FileUploaded"==e.type&&(t.fileDetails=e.userData),t.text=n&&n.text||e.text,t.type=e.type,t.index=e.index,t.timestamp=e.utcTime,t.html=e.html,t.bubble=e.bubble,t.userData=e.userData,t.from={id:e.from?parseInt(e.from.participantId):"",type:e.from?e.from.type:"",name:e.from?e.from.nickname:""},r&&"BOT"===r&&(t.from.type="Bot"),L&&(t.restoring=!0),e.index>=0&&e.index>=P&&(P=e.index+1,c.default.setCookie("_genesys.widgets.webchat.state.index",P)),t},we=function(e){var t=e.type,r=e.from.type,s=e.from.id,i={};if("Message"!=t&&"PushUrl"!=t&&"Notice"!=t||"Agent"!=r&&"Supervisor"!=r||n.publish("agentTypingStopped"),"ParticipantJoined"==t)switch("Agent"!=r&&"Supervisor"!=r||(W[s]={name:e.from.name,connected:!0,supervisor:"Supervisor"==r,connectedTime:e.timestamp,disconnectedTime:!1}),i={message:e,agents:W,numAgentsConnected:Se()},r){case"Client":n.publish("clientConnected",i);break;case"Agent":n.publish("agentConnected",i);break;case"Bot":n.publish("botConnected",i);break;case"Supervisor":n.publish("supervisorConnected",i)}else if("ParticipantLeft"==t)switch(W[s]&&(W[s].connected=!1,W[s].disconnectedTime=e.timestamp),i={message:e,agents:W,numAgentsConnected:Se()},r){case"Client":n.publish("clientDisconnected",i);break;case"Agent":n.publish("agentDisconnected",i),n.publish("agentTypingStopped");break;case"Bot":n.publish("botDisconnected",i);break;case"Supervisor":n.publish("supervisorDisconnected",i),n.publish("agentTypingStopped")}"Agent"!=r&&"Supervisor"!=r||("TypingStarted"==t&&n.publish("agentTypingStarted",e),"TypingStopped"==t&&n.publish("agentTypingStopped",e))},xe=function(){ue||(c.default.deleteCookie(D),c.default.deleteCookie(j),c.default.deleteCookie(R),c.default.deleteCookie("_genesys.widgets.webchat.state.index"))},ke=function(e){return!J[e]&&(J[e]=!0,!0)},Se=function(){var e=0;for(var t in W)!0===W[t].connected&&e++;return e},Ce=function(e){for(var t=0;t<re.standard.length;t++)if((e+"").match(re.standard[t]))return!1;for(var n=0;n<re.custom.length;n++)if((e+"").match(re.custom[n]))return!1;return!0},_e=function(e){if(e instanceof RegExp){e.length||(e=[e]);for(var t=0;t<e.length;t++)re.custom.filter((function(n){return String(n)===String(e[t])})).length||re.custom.push(e[t]);Ie()}},Ie=function(){for(var e,t={custom:[]},n=0;n<re.custom.length;n++)e=re.custom[n],t.custom.push({source:e.source,flags:e.flags});c.default.setCookie(O,JSON.stringify(t))},De=function(){re.custom=[],c.default.deleteCookie(O)},je=function(e){if(!U){var t=C&&C.secureKey;e.chatId&&(C.sessionID=e.chatId),e.secureKey&&(C.secureKey=e.secureKey),e.alias&&(C.alias=e.alias),e.userId&&(C.userId=e.userId),ue&&ce.getSessionData?t!==C.secureKey&&ce.getSessionData(C,u.default,c.default.getCookieOptions()):(c.default.setCookie(j,JSON.stringify({secureKey:C.secureKey,alias:C.alias,userId:C.userId})),c.default.setCookie(D,C.sessionID)),n.data("WebChatService.sessionData",C)}},Re=function(){return!!window.FormData},Oe=function(e){X&&(2===(e=e.data).statusCode&&e.errors&&e.errors.length>0&&n.publish("error",e)),e.chatEnded||e.errors||je(e),ie&&(ie.resolve(e),ie=!1,0!=e.statusCode&&Be()),0==e.statusCode?(M&&(n.publish("chatServerBackOnline"),n.publish("reconnected")),Y=!1,M=!1,m=0):1==e.statusCode&&(++m>v&&(n.publish("chatServerWentOffline"),m=0),M=!0),ue&&(Q||le?be(e):Q=!0),ue||be(e),b=!1,L=!1,de=!1},Pe=function(e){X&&e&&(e=e.data);var t={numAgentsConnected:0};A=!1,Be(),xe(),De(),n.publish("supervisorDisconnected",t),n.publish("agentDisconnected",t),n.publish("clientDisconnected",t),n.publish("ended"),n.command("App.deregisterAutoLoad"),G=!1,ae&&(ae.resolve(e),ae=!1)},Ae=function(){S&&G&&"function"==typeof G.configure&&G.configure({requestHeaders:c.default.filterObjectProperties(n.data("App.requestHeader"),ge)})},Le=function(){X&&((G=new o.default.CometD).websocketEnabled=V.websocketEnabled,G.configure({url:V.cometURL,logLevel:V.logLevel,requestHeaders:S?c.default.filterObjectProperties(n.data("App.requestHeader"),ge):{}}),G.addListener("/meta/handshake",Ee),G.addListener("/meta/connect",Me),G.addListener("/meta/disconnect",Ue),G.addListener("/meta/publish",qe),G.addListener(V.channel,Oe),G.handshake())},Me=function(e){if(Ae(),G&&!G.isDisconnected())if($=!0===e.successful,E&&$){if(E=!1,!M){n.publish("reconnected");var t=ue?C:c.default.getCookie(j);he("requestNotifications","POST",{userId:t.userId,secureKey:t.secureKey,alias:t.alias,transcriptPosition:P,message:""})}}else!E&&$?ue||c.default.setCookie(R,(new Date).getTime()):E||$||"402::Unknown client"!=e.error&&(E=!0,n.publish("disconnected"));else $=!1},Ee=function(e){if(!1===e.successful)ie&&5==++Z&&(Be(),ie.reject({statusCode:1}),ie=!1,Z=0);else if(!0===e.successful){$=!0,Z=0;var t=ue?C:c.default.getCookie(j);if("string"==typeof t&&t.length>0){var n=(t=JSON.parse(t))||{},r=n.secureKey,s=n.userId,i=n.alias;r&&s&&!L&&he("requestNotifications","POST",{userId:s,secureKey:r,alias:i,transcriptPosition:P,message:""})}}},Ue=function(e){G&&(Ae(),G.handshake(),n.publish("disconnected"),E=!0,M=!0,Ke())},qe=function(e){},Ne=function(){n.command("wake")},Fe=function(){T&&(s=f)},Ke=function(){if(!Y&&A){var e=ue?C:c.default.getCookie(j);Y=!0,c.default.watch((function(t,n){return Y&&he("requestNotifications","POST",{userId:e.userId,secureKey:e.secureKey,alias:e.alias,transcriptPosition:P,message:""}),!Y}),3e3,30).fail((function(){v=0,n.publish("chatServerTimeout")}))}},Be=function(){X&&G&&(Ae(),G.disconnect(),G=!1,$=!1)},He=function(){L=!1,C.sessionID="",C.secureKey="",C.alias="",C.userId="",n.publish("restoreFailed")};n.registerCommand("fetchHistory",(function(e){ue?(de=!0,pe-=ce.maxMessagePageSize,fe?(de=!1,e.deferred.reject("No more messages to fetch")):he("refresh","POST",{userId:C.userId,secureKey:C.secureKey,alias:C.alias,transcriptPosition:pe<=0?1:pe,message:""}).done((function(t){e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)}))):e.deferred.reject("Fetching messages history applies to only Asynchronous chat.")})),n.registerCommand("configure",(function(e){if(e.data&&Object.keys(e.data).length){var t=e.data,r="string",i="number",h="boolean",m="object",y="function",b={},C={};if(a(t.apikey)!=r&&a(t.apikey)!=i||(_=t.apikey),a(t.endpoint)==r&&(F=t.endpoint),a(t.userData)==m&&o.default.extend(C,t.userData),a(t.serverURL)==r&&(N=t.serverURL),a(t.ajaxTimeout)==i&&(w=parseInt(t.ajaxTimeout)),a(t.fileUploadTimeout)==i&&(x=parseInt(t.fileUploadTimeout)),a(t.xhrFields)==m&&o.default.extend(k,t.xhrFields),"object"==a(t.cometD)&&(!0===t.cometD.enabled&&(X=!0),o.default.extend(V,t.cometD)),a(t.dataURL)!=r||X||(N=t.dataURL.replace(/\/!*$/,""),X||(N+="/")),a(t.pollExceptionLimit)==i&&(v=parseInt(t.pollExceptionLimit)),a(t.pollIntervalIdle_ms)==i&&(d=parseInt(t.pollIntervalIdle_ms)),a(t.sleepEnabled)==h&&(ee=t.sleepEnabled),a(t.dynamicPolling)==h&&(T=t.dynamicPolling),a(t.pollRate)==i&&t.pollRate>=1e3&&t.pollRate<=3e4&&(l=parseInt(t.pollRate),s=l),a(t.pollRateMin)==i&&t.pollRateMin>=250&&t.pollRateMax<=(t.pollRateMax||l)&&(f=parseInt(t.pollRateMin)),a(t.pollRateMax)==i&&t.pollRateMax<=3e4&&t.pollRateMax>=f&&(d=parseInt(t.pollRateMax)),a(t.pollRateMult)==i&&t.pollRateMult>1&&(p=t.pollRateMult),a(t.pollRateSleep)==i&&t.pollRateSleep<=3e4&&t.pollRateSleep>=1e3&&(g=parseInt(t.pollRateSleep)),a(t.restoreTimeout)==i&&(q=parseInt(t.restoreTimeout)),a(t.maxMessageLength)==i&&(z=t.maxMessageLength),a(t.enableCustomHeader)==h&&(S=t.enableCustomHeader),a(t.async)==m&&X){if(a(t.async.enabled)==h&&(ce.enabled=t.async.enabled),a(t.async.maxMessagePageSize)==i&&(ce.maxMessagePageSize=t.async.maxMessagePageSize),a(t.async.setSessionData)==y){ce.setSessionData=t.async.setSessionData;var I=ce.setSessionData("_genesys.widgets.webchat.state.open",u.default,c.default.getCookieOptions());"undefined"!==I&&I&&"string"==typeof I&&I.length>0?b=JSON.parse(I):I&&"object"==(void 0===I?"undefined":a(I))&&Object.keys(I).length&&(b=I)}a(t.async.getSessionData)==y&&(ce.getSessionData=t.async.getSessionData),ue=ce.enabled&&X}c.default.getCookie(D)?(ue=!1,n.command("restore")):Object.keys(b).length&&(X?(ue=!0,n.command("restore",{sessionData:b})):e.deferred.reject("Invalid configuration. WebChatService supports Async chat only in CometD mode.")),n.data("userData",C),e.deferred.resolve()}else e.deferred.reject("Invalid configuration")})),n.registerCommand("startChat",(function(e){if(Ne(),A)return e.deferred.reject("There is already an active chat session"),!1;e.data&&"boolean"==typeof e.data.async&&(ue=e.data.async);var t={};if("string"==typeof e.data.userData&&""!=e.data.userData.trim()){try{t=JSON.parse(e.data.userData.trim())}catch(t){return e.deferred.reject("malformed JSON provided in userData property"),!1}"object"==(void 0===t?"undefined":a(t))&&(t=o.default.extend({},n.data("userData"),t))}else"object"==a(e.data.userData)&&(t=o.default.extend({},n.data("userData"),e.data.userData));n.data("userData",i({},n.data("userData"),t));var r={_genesys_source:c.default.isMobileDevice()?"mobile":"web",_genesys_referrer:document.referrer,_genesys_url:document.location.href,_genesys_pageTitle:document.title,_genesys_browser:K.browser,_genesys_OS:K.os,_genesys_widgets:c.default.data("version")};t=o.default.extend({GCTI_LanguageCode:oe},n.data("userData"),r),ue&&(le=!0,t=o.default.extend({GCTI_Chat_AsyncMode:"true"},t)),xe(),A=!1,L=!1,y=!1,b=!0,U=!1,C.sessionID="",C.userId="",C.secureKey="",C.alias="",P=1,B=[],H=[],W={},J={},m=0,Z=0,M=!1,E=!1;var s={nickname:e.data.nickname||"",firstName:e.data.firstname||"",lastName:e.data.lastname||"",emailAddress:e.data.email||"",subject:e.data.subject||"",text:"",userData:t};F&&(s.endpoint=F),he("","POST",s).done((function(t){0==t.statusCode?(A=!0,je(t),n.publish("started",C),n.command("startPoll"),n.command("App.registerAutoLoad"),e.deferred.resolve(t)):e.deferred.reject(t)})).fail((function(t){e.deferred.reject(t)}))})),n.registerCommand("getFileLimits",(function(e){ve(X?"fileGetLimits":"/file/limits",{}).done((function(t){e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)}))})),n.registerCommand("endChat",(function(e){if(!A)return e.deferred.reject("There is no active chat session"),!1;n.command("stopPoll"),he("disconnect","POST",{alias:C.alias,secureKey:C.secureKey,userId:C.userId}).fail((function(t){e.deferred.reject(t)})).always(Pe)})),n.registerCommand("getSessionData",(function(e){e.deferred.resolve(C)})),n.registerCommand("restore",(function(e){return L?(e.deferred.reject("Already restoring. Ignoring request."),!1):(A&&e.deferred.reject("Chat session is already active, ignoring restore command."),ue||"WebChatService"==e.commander?(e.data&&e.data.async&&!0===e.data.async.enabled&&(ue=!0),ue?e.data&&e.data.sessionData&&(C=e.data.sessionData)&&(t=C.sessionID,r=C):(t=c.default.getCookie(D),r=c.default.getCookie(j)),"string"==typeof r&&r.length>0&&(r=JSON.parse(r)),void(t&&r&&Object.keys(r).length&&!(!ue&&b&&c.default.getCookie(R)&&(new Date).getTime()-parseInt(c.default.getCookie(R))>=q&&(xe(),De(),n.publish("restoreTimeout"),n.command("App.deregisterAutoLoad"),1))&&(xe(),L=!0,C.sessionID=t,ue?he("refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:Number(-1)}).done((function(t){!1===t.chatEnded&&t.messages.length>0?"number"==typeof(P=parseInt(t.messages[0].index))&&(pe=(pe=parseInt(P-ce.maxMessagePageSize))<=0?1:pe,he("requestNotifications","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:pe,message:""}).done((function(t){t&&0==t.statusCode?(L=!1,A=!0,n.publish("restored",{async:!0}),n.data("WebChatService.mode",{async:!0}),e.deferred.resolve(t)):e.deferred.reject(t)})).fail((function(t){He(),e.deferred.reject()}))):e.deferred.reject(t)})).fail((function(t){He(),e.deferred.reject()})):he(X?"requestNotifications":"refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:P,message:""}).done((function(t){!0===function(e){return je(e),!0===e.chatEnded||void 0===e.chatEnded?(xe(),U=!0,L=!1,C.sessionID="",C.secureKey="",C.alias="",C.userId="",n.publish("restoreTimeout"),n.command("App.deregisterAutoLoad"),Be(),!1):!1===e.chatEnded?(n.publish("restored"),be(e),L=!1,A=!0,n.command("startPoll"),ue||c.default.setCookie(D,C.sessionID),1==e.statusCode&&(n.publish("restoredOffline"),M=!0),!0):void 0}(t)?e.deferred.resolve(t):e.deferred.reject(t)})).fail((function(t){He(),e.deferred.reject()}))))):(e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command in Non-Async mode."),!1));var t,r})),n.registerCommand("sendMessage",(function(e){if(Ne(),E)return e.deferred.resolve({statusCode:1}),!1;if(!A)return e.deferred.reject("There is no active chat session"),!1;if("string"!=typeof e.data.message||""==(e.data.message+"").trim())return e.deferred.reject("No message text provided"),!1;if(z&&[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e.data.message)).length>z)return e.deferred.reject("Message length exceeds configured threshold of ("+z+") characters"),!1;ne.Interval&&n.publish("clientTypingStopped"),clearInterval(ne.Interval),ne.Interval=!1,ne.Timer=0,ne.text="",ne.IdleCount=0;var t={message:e.data.message,messageType:e.data.type||"text",userId:C.userId,secureKey:C.secureKey,alias:C.alias};if("number"==typeof e.data.parentMessageID||"string"==typeof e.data.parentMessageID&&e.data.parentMessageID.length>0){var r='{"general-properties": {"related-event-id":"'+e.data.parentMessageID+'"}}';t.eventAttributes=X?JSON.parse(r):r,delete e.data.parentMessageID}he("send","POST",t).done((function(t){!0===t.chatEnded&&!0===A&&ye(),e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)})).always((function(){Fe()}))})),n.registerCommand("sendFile",(function(e){if(Ne(),!A)return e.deferred.reject("There is no active chat session"),!1;var t=e.data.files.files[0],n=t.name,r={},s=X?"fileUpload":"/file";r.file=t,ve(s,r).done((function(r){if("string"==typeof r&&(r=JSON.parse(r)),0==r.statusCode){var s=new FileReader;(0,o.default)(s).on("load",(function(t){var s={from:{type:"Client"},source:t.target.result,type:"FileUploaded",timestamp:(new Date).getTime(),filename:n};[].push(s),e.deferred.resolve(r)})),s.readAsDataURL(t)}else e.deferred.reject(r)})).fail((function(t){e.deferred.reject(t)})).always((function(){Fe()}))})),n.registerCommand("downloadFile",(function(e){var t;if(X&&V.apiURL)t=(0,o.default)("<form method='POST' enctype='multipart/form-data' target='_blank' action="+V.apiURL+"><input name='secureKey' value="+C.secureKey+" type='hidden'><input name='fileId' value="+e.data.fileId+" type='hidden'><input name='operation' value='fileDownload' type='hidden'></form>").appendTo(document.body);else if(X)e.deferred.reject("Could not download file. Please ensure WebChat is configured properly.");else{var n=N+C.sessionID+"/file/"+e.data.fileId+"/download";t=(0,o.default)("<form method='POST' enctype='multipart/form-data' target='_blank' action="+n+"><input name='alias' value="+C.alias+" type='hidden'><input name='secureKey' value="+C.secureKey+" type='hidden'><input name='userId' value="+C.userId+" type='hidden'></form>").appendTo(document.body)}t&&(t.submit(),e.deferred.resolve())})),n.registerCommand("sendFilteredMessage",(function(e){Ne(),A?(function(e,t){"string"==typeof e&&t instanceof RegExp&&(_e(t),n.command("sendMessage",{message:e}))}(e.data.message,e.data.regex),e.deferred.resolve()):e.deferred.reject("No active chat session.")})),n.registerCommand("addPrefilter",(function(e){if(e.data.filters&&e.data.filters instanceof RegExp)_e(e.data.filters),e.deferred.resolve(o.default.extend({},re.custom));else if(e.data.filters.length>0&&e.data.filters[0]instanceof RegExp){for(var t=0;t<e.data.filters.length;t++)_e(e.data.filters[t]);e.deferred.resolve(o.default.extend({},re.custom))}else e.deferred.reject("Missing or invalid filters provided. Please provide a regular expression or an array of regular expressions")})),n.registerCommand("startPoll",(function(e){return X?(e.deferred.reject("Polling is not supported when using CometD"),!1):A?(!1===r&&(r=t((function(){var e=n.data("sleeping");!e&&!y&&c.default.time()-h>=s?(n.command("poll"),h=c.default.time(),T&&(s<d&&(s=parseInt(s*p)),s>d&&(s=d))):e&&!y&&c.default.time()-h>=g&&(n.command("poll"),h=c.default.time())}),parseInt(f/2)),Fe(),n.publish("pollingStarted")),void e.deferred.resolve()):(e.deferred.reject("There is no active chat session"),!1)})),n.registerCommand("stopPoll",(function(e){if(0==r)return e.deferred.reject("Not currently polling. Ignoring command."),!1;0!=r&&(clearInterval(r),r=!1,n.publish("pollingStopped")),e.deferred.resolve()})),n.registerCommand("poll",(function(e){e.commander!=n.namespace()&&e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command"),y?e.deferred.reject("previous poll has not finished"):(y=!0,ue||c.default.setCookie(R,(new Date).getTime()),he("refresh","POST",{userId:C.userId,secureKey:C.secureKey,alias:C.alias,transcriptPosition:P,message:te?te.val():""}).done((function(t){Oe(t),e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)})).always((function(){y=!1})))})),n.registerCommand("sleep",(function(e){!ee||ue||X||!n.data("sleeping")&&A&&(n.publish("sleeping"),n.data("sleeping",!0)),e.deferred.resolve()})),n.registerCommand("wake",(function(e){var t='{"purpose":"cancel-idle-timer"}';n.data("sleeping")&&A&&(n.publish("waking"),n.data("sleeping",!1),s=l,he("customNotice","POST",{eventAttributes:X?JSON.parse(t):t})),!0===e.data.resetIdleState&&he("customNotice","POST",{eventAttributes:X?JSON.parse(t):t}),e.deferred.resolve()})),n.registerCommand("resetPollExceptions",(function(e){M=!1,m=0,e.deferred.resolve()})),n.registerCommand("sendCustomNotice",(function(e){Ne(),he("customNotice","POST",{alias:C.alias,secureKey:C.secureKey,userId:C.userId,message:e.data.message||""}).done((function(t){e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)}))})),n.registerCommand("updateUserData",(function(e){Ne(),n.data("userData",i({},n.data("userData"),e.data||{})),A?he("updateData","POST",{alias:C.alias,secureKey:C.secureKey,userId:C.userId,userData:e.data||{}}).done((function(t){e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)})):e.deferred.resolve(n.data("userData"))})),n.registerCommand("sendTyping",(function(e){if(!A)return e.deferred.reject("There is no active chat session"),!1;var t=e.data||{},r=!1,s=ne,i={alias:C.alias,secureKey:C.secureKey,userId:C.userId,transcriptPosition:P};if("boolean"!=typeof t.isTyping&&(t.isTyping=!0),X)i.message=t.message||te&&te.val()||"",s.Interval||(s.Interval=setInterval((function(){te&&te.val()!=s.text?(i.message=t.message||te&&te.val()||"",r=he("startTyping","POST",i),s.text=te.val()):++s.IdleCount==s.IdleLimit&&(clearInterval(s.Interval),s.IdleCount=0,s.Interval=!1,i.message=t.message||te&&te.val()||"",r=he("stopTyping","POST",i))}),5e3),r=he("startTyping","POST",i));else{if(s.Interval)return s.Timer=0,e.deferred.resolve(),!1;Ne(),i.message=t.message||te&&te.val()||"",r=he("startTyping","POST",i),n.publish("clientTypingStarted"),s.Interval=setInterval((function(){s.Timer+=s.TimeInterval,s.Timer>=s.Timeout&&(i.message=t.message||te&&te.val()||"",clearInterval(s.Interval),s.Interval=!1,s.Timer=0,r=he("stopTyping","POST",i),n.publish("clientTypingStopped"))}),s.TimeInterval),r.done((function(t){e.deferred.resolve(t)})).fail((function(t){e.deferred.reject(t)}))}})),n.registerCommand("getAgents",(function(e){e.deferred.resolve({agents:o.default.extend(W,{})})})),n.registerCommand("getTranscript",(function(e){e.deferred.resolve({messages:B,originalMessages:H})})),n.registerCommand("getStats",(function(e){var t={agents:o.default.extend(W,{}),startTime:!1,endTime:!1,duration:!1};B.length>0&&(t.startTime=B[0].timestamp,t.endTime=B[B.length-1].timestamp,t.duration=t.endTime-t.startTime),e.deferred.resolve(t)})),n.registerCommand("registerTypingPreviewInput",(function(e){var t=(0,o.default)(e.data.input);!t||"text"!=t[0].type&&"textarea"!=t[0].type?e.deferred.reject("Invalid value provided for the 'input' property. An HTML element reference to a textarea or text input is required."):(te=t,e.deferred.resolve())})),n.registerCommand("registerPreProcessor",(function(e){"function"==typeof e.data.preprocessor?(se.push(e.data.preprocessor),e.deferred.resolve(e.data.preprocessor)):e.deferred.reject("No preprocessor function provided. Type provided was '"+a(e.data.preprocessor)+"'.")})),n.subscribe("GWE.ready",(function(){n.command("GWE.getIDs").done((function(e){n.data("userData",i({},n.data("userData"),e))}))})),n.subscribe("App.language",(function(e){oe=e.data})),n.subscribe("App.data.pageFocus",(function(e){ee&&A&&(!1===e.data.value?n.command("sleep"):!0===e.data.value&&Ne())})),n.subscribe("App.data.pageHidden",(function(e){ee&&A&&(!1===e.data.value&&n.data("App.pageFocus")?Ne():!0===e.data.value&&n.command("sleep"))})),ee&&A&&(n.data("App.pageFocus")?Ne():n.command("sleep")),function(){if(c.default.getCookie(O)){var e=JSON.parse(c.default.getCookie(O));o.default.each(e.custom,(function(){re.custom.push(new RegExp(this.source,this.flags))}))}}(),n.command("configure",_genesys.widgets.webchat),n.ready(),n.republish("ready")}var n="";return{init:function(e){(n=e)&&t()}}}))}},["./webapp/plugins/cx-webchat-service/controllers/legacy-controller.js"]);